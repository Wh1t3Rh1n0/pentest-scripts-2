#!/bin/bash

if [ "$1" == "-h" ] || [ "$1" == "--help" ] ; then
    cat <<EOF

eyewitness-default-creds.sh
===========================

Extracts all default credentials from an EyeWitness report into a single list.
The list is printed to stdout. Call this script from *within* the EyeWitness
report folder.

Usage:

    cd <EyeWitness report folder>
    
    bash <Script path>/eyewitness-default-creds.sh | tee ../default-creds.txt

EOF
    exit
fi

if [ ! -e "$(ls report*.html 2>/dev/null | head -n1)" ] ; then
    cat <<EOF

EyeWitness report files not found.

Call this script from *within* the EyeWitness report folder, or use '-h' to
display usage.       

EOF
    exit
fi


grep -h -B1 -Ei 'default (pass|cred)' report*.html --color=never | sed -E 's#^[^<]+<(a href="|.*br><b>Default )##g' | sed -E 's/" target.*//g' | sed -E 's#</b>|<br>##g' | tr '\n' ' ' | sed -E 's/ -- /\n/g' | awk -F ' credentials: ' '{ print $2 " > " $1 }' | sort -u
