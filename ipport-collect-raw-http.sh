#!/bin/bash

if [ ! -e "$1" ] ; then
    cat <<EOF

ipport-collect-raw-http.sh
==========================

Retrieves HTTP/HTTPS (whichever works) headers and content from a webserver and
saves the output in a IP_PORT-named file inside the folder, 'output.raw-http'.

Useful for doing stuff like grabbing version numbers from the headers/body of
a lot of web servers all at once.

Usage: bash ipport-collect-raw-http.sh <IP:Port list> [Path]

If the optional path is specified, it will be used to request a specific URL
path during every request (e.g., "/README.html").

Example:

    bash ipport-collect-raw-http.sh webservers.txt
    cd output.raw-http
    grep -i '< server' *
EOF
    exit
fi

path="$2"
outdir=output.raw-http
mkdir $outdir

for ipport in $(cat "$1") ; do
safename=$(echo $ipport | tr ':' '_')
echo Requesting "http://$ipport$path"...
curl -vks --connect-timeout 2 "http://$ipport$path" > $outdir/$safename 2>&1
echo Requesting "https://$ipport$path"...
curl -vks --connect-timeout 2 "https://$ipport$path" >> $outdir/$safename 2>&1
done

echo "DONE!"